<!doctype html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>BNK부산은행::입력 정보 확인</title>

    <link rel="stylesheet" th:href="@{/css/common/style_common.css}">
    <link rel="stylesheet" th:href="@{/css/common/style_font.css}">
    <link href="//cdn.jsdelivr.net/xeicon/2/xeicon.min.css" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/_footer.css}">

    <style>
        :root {
            --red-900: #D03238;
            --red-700: #E1545A;
            --red-100: #FAE5E6;
            --white: #ffffff;
            --grey-900: #333333;
            --grey-700: #666666;
            --grey-500: #B9B9B9;
            --grey-400: #B0B0B0;
            --grey-300: #DEDEDE;
            --grey-100: #F8F8F8;
            --container: 1200px;
        }
        * { box-sizing: border-box }

        html,body {
            min-width: 1200px;
            height: 100%;
            overflow-x: auto;
        }
        a { color: inherit; text-decoration: none; }
        .container {
            width: var(--container);
            max-width: calc(100% - 40px);
            margin: 0 auto;
        }

        /* 상단 영역 스타일 */
        .util { background-color: var(--grey-100); border-bottom: 1px solid var(--grey-300); }
        .util_row { display: flex; align-items: center; height: 50px; font-size: 0.85rem; }
        .util_logo { height: 20px; margin-right: 20px; }
        .util_spacer { flex-grow: 1; }
        .util_row a { margin-left: 20px; }
        .util_row i { margin-left: 20px; font-size: 1.1rem; }

        .gnb { background-color: var(--white); border-bottom: 2px solid var(--red-900); }
        .gnb_row { display: flex; align-items: center; height: 60px; }
        .menu { display: flex; font-size: 1rem; font-weight: 600; }
        .menu-item { margin-right: 40px; }
        .gnb_text a { color: var(--red-900); font-size: 0.9rem; margin-left: 50px; }

        .gnb_sub { background-color: var(--grey-100); padding: 10px 0; border-bottom: 1px solid var(--grey-300); }
        .breadcrumb { font-size: 0.9rem; color: var(--grey-700); margin-right: 5px; }

        .content-area {
            min-height: 60vh;
            padding: 50px 0;
            display: flex;
            justify-content: center;
        }

        .review-wrap {
            width: 800px;
        }

        .title-step { color: var(--red-900); font-size: 1.1rem; font-weight: 700; margin-bottom: 10px; }
        .title-main { font-size: 2rem; font-weight: 700; line-height: 1.4; margin-bottom: 40px; color: var(--grey-900); }

        .section-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--grey-900);
            margin-bottom: 20px;
            padding-top: 40px;
            border-top: 1px solid var(--grey-300);
        }
        .section-title:first-of-type { border-top: none; padding-top: 0; }

        /* 입력 정보 확인 테이블 스타일 */
        .info-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 1rem;
            margin-bottom: 30px;
        }
        .info-table th, .info-table td {
            padding: 15px 0;
            border-bottom: 1px solid var(--grey-300);
        }
        .info-table th {
            text-align: left;
            width: 30%;
            color: var(--grey-700);
            font-weight: 500;
        }
        .info-table td {
            text-align: right;
            font-weight: 600;
            color: var(--grey-900);
        }
        .info-table td.highlight {
            color: var(--red-900);
            font-weight: 700;
        }
        .info-table .text-link {
            font-size: 0.9rem;
            color: var(--red-900);
            cursor: pointer;
            margin-left: 10px;
        }

        /* 이해 확인 그룹 스타일 (메인 페이지) */
        .check-group {
            margin-bottom: 40px;
            padding: 20px;
            border: 1px solid var(--grey-300);
            border-radius: 8px;
        }
        .check-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px dashed var(--grey-300);
        }
        .check-item:last-of-type { border-bottom: none; }
        .check-item-label {
            font-size: 1rem;
            color: var(--grey-900);
            font-weight: 600;
        }
        .check-item-action {
            display: flex;
            gap: 10px;
        }

        /* 메인 페이지 토글 버튼 기본 스타일 */
        .check-group .toggle-btn {
            padding: 8px 15px;
            border: 1px solid var(--grey-500);
            border-radius: 5px;
            background-color: var(--white);
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 600;
            color: var(--grey-700);
            transition: all 0.2s;
        }
        .check-group .toggle-btn.selected {
            border-color: var(--red-900);
            background-color: var(--red-100);
            color: var(--red-900);
        }

        /* 전자서명 및 최종 버튼 스타일 */
        .sign-area {
            text-align: center;
            padding: 40px 0;
        }
        .sign-button {
            padding: 15px 30px;
            background-color: var(--grey-900);
            color: var(--white);
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            margin-bottom: 20px;
        }
        .sign-info {
            font-size: 0.9rem;
            color: var(--grey-700);
        }

        /* 하단 버튼 영역 */
        .button-area {
            display: flex;
            justify-content: space-between;
            padding-top: 40px;
        }
        .btn-prev {
            width: 30%;
            padding: 15px 0;
            border: 1px solid var(--grey-300);
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--grey-900);
            background-color: var(--white);
            cursor: pointer;
        }
        .btn-next {
            width: 65%;
            padding: 15px 0;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--white);
            background-color: var(--red-900);
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .btn-next:disabled {
            background-color: var(--grey-300);
            cursor: not-allowed;
        }

        /* 모달 팝업 스타일 */
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.5); justify-content: center; align-items: center; }
        .modal-content { background-color: var(--white); margin: auto; padding: 30px; border-radius: 10px; width: 90%; max-width: 750px; box-shadow: 0 5px 15px rgba(0,0,0,0.3); position: relative; }
        .modal-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--grey-300); padding-bottom: 15px; margin-bottom: 20px; }
        .modal-header h2 { font-size: 1.5rem; font-weight: 700; color: var(--grey-900); }
        .close-btn { color: var(--grey-500); font-size: 2rem; font-weight: bold; cursor: pointer; transition: color 0.2s; }
        .modal-body { max-height: 85vh; overflow-y: auto; padding-right: 15px; line-height: 1.6; font-size: 0.95rem; color: var(--grey-700); }
        .modal-body strong { color: var(--red-900); font-weight: 700; }

        /* 전자서명 모달 본문 스타일 */
        .contract-preview {
            border: 1px solid var(--grey-300);
            padding: 15px;
            background-color: var(--grey-100);
            max-height: 55vh;
            overflow-y: auto;
            margin-bottom: 20px;
        }
        .contract-preview h3 { font-size: 1.1rem; color: var(--grey-900); margin-bottom: 10px; }
        .contract-content { font-size: 0.85rem; color: var(--grey-700); line-height: 1.4; white-space: pre-wrap; }
        .confirm-question { font-size: 1.1rem; color: var(--grey-900); font-weight: 600; margin-bottom: 15px; }

        .modal-footer { padding-top: 20px; text-align: center; display: flex; justify-content: space-between; gap: 10px; }
        .modal-footer button { padding: 12px 25px; border: none; border-radius: 6px; font-size: 1rem; font-weight: 700; cursor: pointer; flex-grow: 1; }
        .modal-footer .btn-secondary { background-color: var(--grey-300); color: var(--grey-900); }
        .modal-footer .btn-primary { background-color: var(--red-900); color: var(--white); }

        /* 모달 내 최종 동의 토글 버튼 스타일 (계약서 하단) */
        #modalAgreement {
            display: flex;
            justify-content: center;
            gap: 10px;
        }
        #modalAgreement .toggle-btn {
            padding: 10px 20px;
            border: 1px solid var(--grey-400);
            background-color: var(--white);
            color: var(--grey-700);
            cursor: pointer;
            border-radius: 5px;
            transition: all 0.2s;
            flex-grow: 1;
            font-weight: 500;
        }
        #modalAgreement .toggle-btn.selected {
            border-color: var(--red-900);
            background-color: var(--red-100);
            color: var(--red-900);
            font-weight: 700;
            box-shadow: 0 0 0 1px var(--red-900) inset;
        }

        /* ✅ 계약서 내 체크박스 스타일 추가 */
        .contract-checkbox-wrapper {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin: 15px 0;
        }
        .contract-checkbox-item {
            display: flex;
            align-items: center;
            cursor: pointer;
        }
        .contract-checkbox-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            margin-right: 8px;
            cursor: pointer;
            accent-color: var(--red-900);
        }
        .contract-checkbox-item label {
            cursor: pointer;
            font-size: 0.95rem;
            color: var(--grey-900);
        }
    </style>
</head>

<body>
<section>
    <article class="util">
        <div class="container util_row">
            <a th:href="@{/}" class="util_logo" aria-label="부산은행 홈">
                <img class="logo-img" th:src="@{/images/main/Busanbank_logo.png}" alt="부산은행 로고"></img>
            </a>
            <div class="util_spacer"></div>
            <a href="#">로그인</a>
            <a href="#">고객센터</a>
            <a href="#">은행소개</a>
            <a href="#">Global <i class="xi-caret-down-min"></i></a>
            <i class="xi-search"></i>
        </div>
    </article>

    <article class="gnb">
        <div class="container gnb_row">
            <nav class="menu">
                <div class="menu-item"><a href="#">예금상품</a></div>
                <div class="menu-item"><a href="#">예금이용가이드</a></div>
                <div class="menu-item"><a href="#">금융서비스</a></div>
            </nav>
            <div class="gnb_text">
                <a href="#">금융을 편리하게. 미래를 풍요롭게.</a>
            </div>
        </div>
    </article>

    <article class="gnb_sub">
        <div class="container gnb_sub_row">
            <a href="#" class="breadcrumb">예금상품<i class="xi-angle-right-min"></i></a>
            <a href="#" class="breadcrumb">가입하기</a>
        </div>
    </article>
</section>

<section class="container content-area">
    <div class="review-wrap">
        <p class="title-step">STEP 3/4</p>
        <h2 class="title-main">입력하신 정보와 계약 내용을 확인해주세요.</h2>

        <form id="reviewForm">
            <h3 class="section-title">입력하신 정보 확인</h3>
            <table class="info-table">
                <tr>
                    <th>출금 계좌</th>
                    <td>신한 110-123-123456 <span class="text-link" onclick="alert('STEP 2로 이동하여 정보를 수정합니다.')">수정</span></td>
                </tr>
                <tr>
                    <th>가입 금액</th>
                    <td id="displayAmount">500,000원</td>
                </tr>
                <tr>
                    <th>가입 기간</th>
                    <td id="displayTerm">1개월 (2025.12.10 만기)</td>
                </tr>
                <tr>
                    <th>과세 유형</th>
                    <td id="displayTaxType">일반과세</td>
                </tr>
                <tr>
                    <th>이자 지급 방법</th>
                    <td>만기 일시 지급-단리식</td>
                </tr>
                <tr>
                    <th>적용 이율</th>
                    <td class="highlight">연 2.35%</td>
                </tr>
                <tr>
                    <th>상품 만기 알림</th>
                    <td>신청 (카카오톡/문자메세지)</td>
                </tr>
            </table>

            <h3 class="section-title">충분히 이해하셨나요?</h3>
            <div class="check-group">
                <div class="check-item" data-check="check1">
                        <span class="check-item-label">
                            만기일 전에 중도해지하면 약정 이자율이 아닌 <br/>
                            **중도해지 이자율이 적용됨**을 이해하셨나요?
                        </span>
                    <div class="check-item-action toggle-group">
                        <button type="button" class="toggle-btn" data-value="Y">예</button>
                        <button type="button" class="toggle-btn" data-value="N">아니요</button>
                    </div>
                </div>

                <div class="check-item" data-check="check2">
                        <span class="check-item-label">
                            최종 적용 이자율은 만기 시점에 확정된 <br/>
                            **우대이자율에 따라 달라짐**을 이해하셨나요?
                        </span>
                    <div class="check-item-action toggle-group">
                        <button type="button" class="toggle-btn" data-value="Y">예</button>
                        <button type="button" class="toggle-btn" data-value="N">아니요</button>
                    </div>
                </div>
            </div>

            <h3 class="section-title">예금상품계약서 전자서명</h3>
            <div class="sign-area">
                <button type="button" id="signButton" class="sign-button" data-modal-target="signatureModal">
                    전자서명 대신, 계약서 확인하고 가입하기
                </button>
                <p id="signStatus" class="sign-info">
                    **[필수]** 위 버튼을 눌러 계약서 내용을 확인하고 동의해주세요.
                </p>
            </div>


            <div class="button-area">
                <button type="button" class="btn-prev" onclick="history.back()">이전 (STEP 2로)</button>
                <button id="btnNext" class="btn-next" type="submit" disabled>다음 (STEP 4로)</button>
            </div>
        </form>
    </div>
</section>

<div id="signatureModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>전자서명 대신, 아래 내용을 확인하고</h2>
            <span class="close-btn" data-modal-close="signatureModal">&times;</span>
        </div>

        <div class="modal-body">
            <div class="contract-preview">
                <div class="contract-header" style="text-align: center; margin-bottom: 15px;">
                    <h3 style="font-size: 1.1rem; font-weight: 700; color: var(--grey-900); margin-bottom: 5px;">[예금상품 계약서]</h3>
                    <span style="font-size: 0.9rem; color: var(--grey-500);">신한은행 준법감시인 사전심사필 제2022-4</span>
                </div>

                <table style="width: 100%; border-collapse: collapse; font-size: 0.95rem; margin-bottom: 20px;">
                    <tbody style="border: 1px solid var(--grey-300);">
                    <tr>
                        <th style="width: 25%; background-color: #f0f0f0; border: 1px solid var(--grey-300); padding: 8px 10px; text-align: center; color: var(--grey-700); font-weight: 500;">상품명 (업체명)</th>
                        <td colspan="3" style="width: 75%; border: 1px solid var(--grey-300); padding: 8px 10px; text-align: center; color: var(--grey-900);">신한 My플러스 정기예금 (신한은행)</td>
                    </tr>
                    <tr>
                        <th style="width: 25%; background-color: #f0f0f0; border: 1px solid var(--grey-300); padding: 8px 10px; text-align: center; color: var(--grey-700); font-weight: 500;">신규 금액</th>
                        <td style="width: 25%; border: 1px solid var(--grey-300); padding: 8px 10px; text-align: center; color: var(--grey-900);" id="contractAmount">500,000원</td>
                        <th style="width: 25%; background-color: #f0f0f0; border: 1px solid var(--grey-300); padding: 8px 10px; text-align: center; color: var(--grey-700); font-weight: 500;">계약 기간</th>
                        <td style="width: 25%; border: 1px solid var(--grey-300); padding: 8px 10px; text-align: center; color: var(--grey-900);" id="contractTerm">1개월</td>
                    </tr>
                    <tr>
                        <th style="width: 25%; background-color: #f0f0f0; border: 1px solid var(--grey-300); padding: 8px 10px; text-align: center; color: var(--grey-700); font-weight: 500;">자동 이체 계좌</th>
                        <td style="width: 25%; border: 1px solid var(--grey-300); padding: 8px 10px; text-align: center; color: var(--grey-900);">-</td>
                        <th style="width: 25%; background-color: #f0f0f0; border: 1px solid var(--grey-300); padding: 8px 10px; text-align: center; color: var(--grey-700); font-weight: 500;">이자 주기 및 납입일</th>
                        <td style="width: 25%; border: 1px solid var(--grey-300); padding: 8px 10px; text-align: center; color: var(--grey-900);">-</td>
                    </tr>
                    <tr>
                        <th style="width: 25%; background-color: #f0f0f0; border: 1px solid var(--grey-300); padding: 8px 10px; text-align: center; color: var(--grey-700); font-weight: 500;">최초 신규 적용 이율</th>
                        <td style="width: 25%; border: 1px solid var(--grey-300); padding: 8px 10px; text-align: center; color: var(--grey-900);">연 2.35%</td>
                        <th style="width: 25%; background-color: #f0f0f0; border: 1px solid var(--grey-300); padding: 8px 10px; text-align: center; color: var(--grey-700); font-weight: 500;">이자 지급 방식</th>
                        <td style="width: 25%; border: 1px solid var(--grey-300); padding: 8px 10px; text-align: center; color: var(--grey-900);">만기일시지급 단리식</td>
                    </tr>
                    <tr>
                        <th style="width: 25%; background-color: #f0f0f0; border: 1px solid var(--grey-300); padding: 8px 10px; text-align: center; color: var(--grey-700); font-weight: 500;">과세 구분</th>
                        <td style="width: 25%; border: 1px solid var(--grey-300); padding: 8px 10px; text-align: center; color: var(--grey-900);" id="contractTaxType">일반과세</td>
                        <th style="width: 25%; background-color: #f0f0f0; border: 1px solid var(--grey-300); padding: 8px 10px; text-align: center; color: var(--grey-700); font-weight: 500;">유의사항</th>
                        <td style="width: 25%; border: 1px solid var(--grey-300); padding: 8px 10px; text-align: center; color: var(--grey-900);">유</td>
                    </tr>
                    <tr>
                        <th style="width: 25%; background-color: #f0f0f0; border: 1px solid var(--grey-300); padding: 8px 10px; text-align: center; color: var(--grey-700); font-weight: 500;">계약 체결일</th>
                        <td style="width: 25%; border: 1px solid var(--grey-300); padding: 8px 10px; text-align: center; color: var(--grey-900);">2025.11.10</td>
                        <th style="width: 25%; background-color: #f0f0f0; border: 1px solid var(--grey-300); padding: 8px 10px; text-align: center; color: var(--grey-700); font-weight: 500;">연결 계좌 (자동해지 시)</th>
                        <td style="width: 25%; border: 1px solid var(--grey-300); padding: 8px 10px; text-align: center; color: var(--grey-900);">110-123-123456</td>
                    </tr>
                    </tbody>
                </table>

                <div class="contract-section">
                    <h4 style="font-size: 1rem; font-weight: 700; color: var(--grey-900); margin-top: 15px; margin-bottom: 10px;">■ 예금상품 계약 체결에 관한 사항</h4>
                    <p style="font-size: 0.9rem; color: var(--grey-700); line-height: 1.6; margin-bottom: 15px;">※ 충분한 이해 없이 답변하는 경우 추후 소송이나 분쟁 발생 시 본인에게 불리하게 작용할 수 있으니 질문에 답해 주십시오.</p>

                    <!-- ✅ 체크박스로 변경 -->
                    <div style="border: 1px solid var(--grey-300); padding: 15px; margin-bottom: 15px;">
                        <p style="margin-bottom: 10px; font-weight: 600;">본인은 위 예금상품의 중요한 사항을 충분히 설명받고 이해하였습니까?</p>
                        <div class="contract-checkbox-wrapper">
                            <div class="contract-checkbox-item">
                                <input type="checkbox" id="contractUnderstandYes" name="contractUnderstand" value="yes">
                                <label for="contractUnderstandYes">예</label>
                            </div>
                            <div class="contract-checkbox-item">
                                <input type="checkbox" id="contractUnderstandNo" name="contractUnderstand" value="no">
                                <label for="contractUnderstandNo">아니요</label>
                            </div>
                        </div>
                    </div>

                    <h4 style="font-size: 1rem; font-weight: 700; color: var(--grey-900); margin-top: 15px; margin-bottom: 10px;">■ 예금상품의 중요한 사항이 포함된 예금상품의 중요 내용 요약</h4>
                    <ul style="list-style: disc; margin-left: 20px; font-size: 0.9rem; color: var(--grey-700); line-height: 1.6; margin-bottom: 15px;">
                        <li>상품의 개요 (계약 기간, 이자의 지급 시기 및 지급 방식 등)</li>
                        <li>이자율 및 이자 계산 방법, 중도해지 이자율 및 만기 이율, 이자율 변경에 관한 사항</li>
                        <li>계약이 해지(예외적으로 해지)되거나, 해지이율, 예금자 보호 여부 및 그 내용</li>
                        <li>손실 발생 위험, 민원 처리 및 분쟁 조정, 금융소비자 권리 침해 시 구제 방법</li>
                    </ul>
                    <textarea readonly style="width: 100%; height: 100px; border: 1px solid var(--grey-300); padding: 10px; margin-top: 10px; background-color: var(--white); resize: none; font-size: 0.9rem; color: var(--grey-900); line-height: 1.4;">
이 예금 상품 계약서에 명시된 모든 내용을 충분히 읽고 이해하였으며, 이 계약에 동의합니다.
2025년 11월 10일
성명(법인 대표): 김수진
(인)
                    </textarea>

                    <div class="sign-area" style="text-align: right; padding-top: 15px;">
                        <span style="font-size: 0.9rem; color: var(--grey-700);">**전자서명 대신, 위 내용을 확인하고 가입을 진행합니다.**</span><br>
                        <span style="font-size: 0.95rem; color: var(--grey-900); font-weight: 700;">**2025년 11월 10일 (전자)김수진 (법정)대리인**</span>
                    </div>
                </div>
            </div>

            <p class="confirm-question">
                위 **[예금상품계약서]** 내용을 모두 확인하고,<br>
                상품가입과 관련된 계약정보를 **모두 확인하고 이해했음을 동의**하시겠습니까?
            </p>

            <div class="check-item-action toggle-group" id="modalAgreement" style="justify-content: center; margin-bottom: 20px;">
                <button type="button" class="toggle-btn" data-modal-value="Y">예, 동의합니다.</button>
                <button type="button" class="toggle-btn" data-modal-value="N">아니요</button>
            </div>

        </div>
        <div class="modal-footer">
            <button type="button" class="btn-secondary" data-modal-close="signatureModal">취소</button>
            <button type="button" class="btn-primary" id="confirmSignatureBtn" disabled>다음 단계로</button>
        </div>
    </div>
</div>


<!-- Footer 부분 -->
<div th:replace="~{_footer :: footerFragment}"></div>

<script>
    window.BASE_URL = /*[[@{/}]]*/ "/busanbank/";

    // STEP 2에서 전달받은 데이터 가져오기
    const userData = {
        amount: sessionStorage.getItem('amount') || '500000',
        term: sessionStorage.getItem('term') || '1',
        taxType: sessionStorage.getItem('taxType') || 'general'
    };

    // 페이지 로드 시 데이터 표시
    window.addEventListener('load', function() {
        // 가입 금액
        const amount = parseInt(userData.amount);
        document.getElementById('displayAmount').textContent = amount.toLocaleString() + '원';
        document.getElementById('contractAmount').textContent = amount.toLocaleString() + '원';

        // 가입 기간
        const term = parseInt(userData.term);
        const today = new Date();
        const maturityDate = new Date(today.setMonth(today.getMonth() + term));
        const maturityStr = maturityDate.getFullYear() + '.' +
            String(maturityDate.getMonth() + 1).padStart(2, '0') + '.' +
            String(maturityDate.getDate()).padStart(2, '0');

        document.getElementById('displayTerm').textContent = term + '개월 (' + maturityStr + ' 만기)';
        document.getElementById('contractTerm').textContent = term + '개월';

        // 과세 유형
        const taxTypeText = userData.taxType === 'general' ? '일반과세' : '비과세종합';
        document.getElementById('displayTaxType').textContent = taxTypeText;
        document.getElementById('contractTaxType').textContent = taxTypeText;
    });

    // STEP 3 동의 상태 관리
    const requirements = {
        check1: false, // 중도해지 이자율 이해 확인
        check2: false, // 최종 이자율 이해 확인
        contractUnderstand: false, // ✅ 계약서 내 이해 확인
        signed: false  // 전자서명 완료 (모달 내 '예' 선택 및 '가입하기' 클릭 완료)
    };

    const form = document.getElementById('reviewForm');
    const btnNext = document.getElementById('btnNext');
    const signStatus = document.getElementById('signStatus');
    const signatureModal = document.getElementById('signatureModal');
    const modalAgreementGroup = document.getElementById('modalAgreement');
    const confirmSignatureBtn = document.getElementById('confirmSignatureBtn');

    // ✅ 계약서 내 체크박스
    const contractYes = document.getElementById('contractUnderstandYes');
    const contractNo = document.getElementById('contractUnderstandNo');

    // ------------------
    // 헬퍼 함수
    // ------------------

    // 필수 항목 충족 여부 체크 및 다음 버튼 활성화
    function checkAllRequirements() {
        const allChecked = requirements.check1 && requirements.check2 && requirements.signed;

        btnNext.disabled = !allChecked;
    }

    // ✅ 계약서 내 체크 상태 확인
    function checkContractUnderstanding() {
        requirements.contractUnderstand = contractYes.checked;

        // '예'를 체크해야 모달 내 동의 버튼 활성화 가능
        if (!requirements.contractUnderstand) {
            modalAgreementGroup.querySelectorAll('.toggle-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            confirmSignatureBtn.disabled = true;
        }
    }

    // 모달 닫기 공통 함수
    function closeModal(modalId) {
        document.getElementById(modalId).style.display = 'none';
        document.body.style.overflow = '';
    }

    // ------------------
    // 이벤트 리스너
    // ------------------

    // 이해 확인 토글 버튼 클릭 이벤트 (메인 페이지 - check1, check2)
    document.querySelectorAll('.check-group .toggle-group').forEach(group => {
        group.addEventListener('click', (e) => {
            const target = e.target;
            if (target.tagName === 'BUTTON') {
                group.querySelectorAll('.toggle-btn').forEach(btn => btn.classList.remove('selected'));
                target.classList.add('selected');

                const checkKey = group.closest('.check-item').getAttribute('data-check');
                requirements[checkKey] = (target.dataset.value === 'Y');

                checkAllRequirements();
            }
        });
    });

    // 전자서명 버튼 클릭 시 모달 띄우기
    document.getElementById('signButton').addEventListener('click', (e) => {
        e.preventDefault();
        document.getElementById('signatureModal').style.display = 'flex';
        document.body.style.overflow = 'hidden';

        // 모달을 다시 열었을 때, 모달 내 버튼 상태 초기화
        confirmSignatureBtn.disabled = true;
        modalAgreementGroup.querySelectorAll('.toggle-btn').forEach(btn => btn.classList.remove('selected'));

        // ✅ 체크박스 초기화
        contractYes.checked = false;
        contractNo.checked = false;
        requirements.contractUnderstand = false;
    });

    // ✅ 계약서 내 체크박스 이벤트 - 하나만 선택 가능하도록
    contractYes.addEventListener('change', function() {
        if (this.checked) {
            contractNo.checked = false;
        }
        checkContractUnderstanding();
    });

    contractNo.addEventListener('change', function() {
        if (this.checked) {
            contractYes.checked = false;
            requirements.contractUnderstand = false;
            // '아니요' 선택 시 동의 버튼 비활성화
            modalAgreementGroup.querySelectorAll('.toggle-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            confirmSignatureBtn.disabled = true;
        }
    });

    // 모달 내 최종 동의 '예/아니오' 버튼 클릭 이벤트
    modalAgreementGroup.addEventListener('click', (e) => {
        const target = e.target;
        if (target.tagName === 'BUTTON') {
            // ✅ 계약서 내에서 '예'를 체크해야만 동의 가능
            if (!requirements.contractUnderstand) {
                alert('계약서 내용을 충분히 이해하였는지 먼저 확인해주세요.');
                return;
            }

            modalAgreementGroup.querySelectorAll('.toggle-btn').forEach(btn => btn.classList.remove('selected'));
            target.classList.add('selected');

            const isAgreed = (target.dataset.modalValue === 'Y');
            confirmSignatureBtn.disabled = !isAgreed;
        }
    });

    // 전자서명 모달 - '다음 단계로' 버튼 클릭 이벤트
    confirmSignatureBtn.addEventListener('click', () => {
        requirements.signed = true;
        signStatus.innerHTML = '<strong style="color: var(--red-900);">[완료]</strong> 계약 내용을 확인하고 가입에 동의했습니다.';
        closeModal('signatureModal');
        checkAllRequirements();
    });

    // 모달 닫기 버튼/배경 클릭 이벤트
    document.querySelectorAll('[data-modal-close]').forEach(btn => {
        btn.addEventListener('click', (e) => {
            const modalId = e.target.getAttribute('data-modal-close');
            closeModal(modalId);
        });
    });
    window.addEventListener('click', (e) => {
        if (e.target.classList.contains('modal')) {
            closeModal(e.target.id);
        }
    });

    // 최종 '다음' 버튼 제출 처리 (STEP 4로 이동)
    form.addEventListener('submit', (e) => {
        e.preventDefault();
        if (!btnNext.disabled) {
            alert("입력 정보 확인이 완료되었습니다. STEP 4 최종 확인 페이지로 이동합니다.");
            window.location.href = `${window.BASE_URL}prod/productjoin/step4`;
        }
    });

    // 초기 상태 확인
    checkAllRequirements();
</script>
</body>
</html>