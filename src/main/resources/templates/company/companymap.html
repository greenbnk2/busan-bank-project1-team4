<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>BNKë¶€ì‚°ì€í–‰::ì˜ì—…ì ì•ˆë‚´</title>

    <!-- ê¸°ì¡´ í”„ë¡œì íŠ¸ ìŠ¤íƒ€ì¼ -->
    <link rel="stylesheet" th:href="@{/css/common/style_common.css}">
    <link rel="stylesheet" th:href="@{/css/common/style_font.css}">
    <link rel="stylesheet" th:href="@{/css/common/xeicon.css}">
    <link rel="stylesheet" th:href="@{/css/_header.css}">
    <link rel="stylesheet" th:href="@{/css/_footer.css}">

    <script th:src="@{/js/_header.js}" defer></script>

    <style>
        /* ===== ë¦¬ì…‹ ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            width: 100%;
            height: auto;
        }

        body {
            font-family: 'Segoe UI', 'Noto Sans KR', sans-serif;
            color: #333;
            background-color: #fff;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        a {
            text-decoration: none;
            color: inherit;
        }

        button {
            border: none;
            background: none;
            cursor: pointer;
            font-family: inherit;
        }

        /* ===== ìƒ‰ìƒ ë³€ìˆ˜ ===== */
        :root {
            --primary-dark: #D03238;
            --primary-light: #E1545A;
            --secondary-light: #FFE9EA;
            --secondary-mid: #FFB9BD;
        }

        /* ===== MAIN ===== */
        main {
            min-height: calc(100vh - 300px);
            padding: 40px 0;
        }

        .page-header {
            border-bottom: 3px solid var(--primary-dark);
            padding-bottom: 15px;
            margin-bottom: 30px;
        }

        .page-header h1 {
            font-size: 28px;
            font-weight: 700;
            color: #1a1a1a;
            margin-bottom: 8px;
        }

        .page-header .subtitle {
            font-size: 13px;
            color: #666;
        }

        /* ===== TAB ===== */
        .tab-menu {
            display: flex;
            gap: 0;
            border-bottom: 1px solid #ddd;
            margin-bottom: 25px;
            overflow-x: auto;
        }

        .tab-btn {
            padding: 12px 20px;
            background-color: #f9f9f9;
            border: none;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            color: #666;
            white-space: nowrap;
            transition: all 0.3s ease;
        }

        .tab-btn:hover {
            background-color: #f0f0f0;
        }

        .tab-btn.active {
            background-color: var(--primary-dark);
            color: #fff;
            border-bottom-color: var(--primary-dark);
        }

        /* ===== SEARCH ===== */
        .search-section {
            margin-bottom: 25px;
            display: flex;
            justify-content: center;
        }

        .search-container {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .search-select {
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            background-color: #fff;
            cursor: pointer;
            min-width: 150px;
        }

        .search-btn {
            padding: 10px 30px;
            background-color: var(--primary-dark);
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .search-btn:hover {
            background-color: #b71c1c;
        }

        /* ===== CONTENT ===== */
        .content-wrapper {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            min-height: 600px;
        }

        .branch-list-section {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .branch-list {
            flex: 1;
            overflow-y: auto;
            padding-right: 10px;
            max-height: 600px;
        }

        .branch-list::-webkit-scrollbar {
            width: 8px;
        }

        .branch-list::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        .branch-list::-webkit-scrollbar-thumb {
            background: var(--primary-dark);
            border-radius: 4px;
        }

        /* ===== BRANCH ITEM ===== */
        .branch-item {
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 10px;
            background-color: #fafafa;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .branch-item:hover {
            border-color: var(--primary-dark);
            background-color: #fff;
            box-shadow: 0 2px 8px rgba(208, 50, 56, 0.15);
        }

        .branch-item.active {
            border-color: var(--primary-dark);
            background-color: var(--secondary-light);
            box-shadow: 0 2px 8px rgba(208, 50, 56, 0.2);
        }

        .branch-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
        }

        .branch-name {
            font-size: 15px;
            font-weight: 600;
            color: #1a1a1a;
            margin: 0;
        }

        .tag-safebox {
            background-color: var(--primary-dark);
            color: white;
            padding: 3px 8px;
            font-size: 11px;
            font-weight: 600;
            border-radius: 3px;
            white-space: nowrap;
        }

        .branch-info {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 10px;
        }

        .branch-detail {
            font-size: 12px;
        }

        .branch-detail.full-width {
            grid-column: 1 / -1;
        }

        .branch-detail .label {
            display: block;
            color: #999;
            font-size: 11px;
            margin-bottom: 3px;
            font-weight: 500;
        }

        .branch-detail .value {
            display: block;
            color: #333;
            font-size: 12px;
            font-weight: 500;
        }

        .branch-footer {
            padding-top: 10px;
            border-top: 1px solid #eee;
        }

        .branch-footer .phone {
            font-size: 12px;
            color: var(--primary-dark);
            font-weight: 600;
        }

        /* ===== PAGINATION ===== */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 5px;
            padding: 15px 0;
            border-top: 1px solid #eee;
        }

        .page-btn {
            padding: 8px 12px;
            background-color: #f5f5f5;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
        }

        .page-btn:hover:not(:disabled) {
            background-color: var(--primary-dark);
            color: white;
            border-color: var(--primary-dark);
        }

        .page-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .page-numbers {
            display: flex;
            gap: 5px;
        }

        .page-num {
            padding: 6px 10px;
            background-color: #f5f5f5;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .page-num:hover {
            background-color: #e0e0e0;
        }

        .page-num.active {
            background-color: var(--primary-dark);
            color: white;
            border-color: var(--primary-dark);
        }

        /* ===== MAP ===== */
        .map-section {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .map-controls {
            display: flex;
            gap: 8px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }

        .map-btn {
            padding: 8px 15px;
            background-color: #f5f5f5;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .map-btn:hover {
            background-color: var(--primary-dark);
            color: white;
            border-color: var(--primary-dark);
        }

        .map-container {
            width: 100%;
            height: 400px;
            border-radius: 6px;
            overflow: hidden;
            border: 1px solid #ddd;
            background: #e0e0e0;
        }

        .map-info {
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 15px;
            background-color: #fafafa;
            min-height: 120px;
        }

        .info-content {
            font-size: 13px;
            line-height: 1.6;
            color: #666;
        }

        .info-content .info-title {
            font-weight: 600;
            color: #1a1a1a;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .info-content .info-item {
            display: flex;
            justify-content: space-between;
            padding: 6px 0;
            border-bottom: 1px solid #eee;
        }

        .info-content .info-item:last-child {
            border-bottom: none;
        }

        .info-content .info-label {
            font-weight: 500;
            color: #999;
            min-width: 60px;
        }

        .info-content .info-value {
            color: #333;
            font-weight: 500;
        }

        .info-content .info-value.highlight {
            color: var(--primary-dark);
            font-weight: 600;
        }

        .error {
            background-color: #ffebee;
            border: 1px solid #ffcdd2;
            border-radius: 4px;
            padding: 15px;
            color: #c62828;
            margin: 20px 0;
            text-align: center;
            font-size: 13px;
        }

        /* ===== ë°˜ì‘í˜• ===== */
        @media (max-width: 1024px) {
            .content-wrapper {
                grid-template-columns: 1fr;
            }

            .map-container {
                height: 350px;
            }
        }

        @media (max-width: 768px) {
            .page-header h1 {
                font-size: 22px;
            }

            .tab-btn {
                padding: 10px 15px;
                font-size: 12px;
            }
        }

        @media (max-width: 480px) {
            .page-header h1 {
                font-size: 18px;
            }

            .search-select,
            .search-btn {
                flex: 1;
                min-width: 100px;
            }

            .branch-info {
                grid-template-columns: 1fr;
            }

            .map-container {
                height: 250px;
            }
        }
    </style>
</head>

<body>
<!-- Header ë¶€ë¶„ -->
<section>
    <article class="util">
        <div class="container util_row">
            <img class="util_logo" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 200 50'%3E%3Ctext x='10' y='35' font-size='24' font-weight='bold' fill='%23D03238'%3EBNKë¶€ì‚°ì€í–‰%3C/text%3E%3C/svg%3E" alt="BNKë¶€ì‚°ì€í–‰">
            <div class="util_spacer"></div>
            <a href="#">ë¡œê·¸ì¸</a>
            <a href="#">ê³ ê°ì„¼í„°</a>
            <a href="#">ì€í–‰ì†Œê°œ</a>
        </div>
    </article>

    <article class="gnb">
        <div class="container gnb_row">
            <nav class="menu">
                <div class="menu-item">
                    <a href="#">ì˜ˆê¸ˆìƒí’ˆ</a>
                </div>
                <div class="menu-item">
                    <a href="#">ì˜ˆê¸ˆì´ìš©ê°€ì´ë“œ</a>
                </div>
                <div class="menu-item">
                    <a href="#">ê¸ˆìœµì„œë¹„ìŠ¤</a>
                </div>
            </nav>
        </div>
    </article>

    <article class="gnb_sub">
        <div class="container gnb_sub_row">
            <a href="#" class="breadcrumb">ì˜ì—…ì ì•ˆë‚´ ></a>
        </div>
    </article>
</section>

<!-- MAIN CONTENT -->
<main>
    <div class="container">
        <div class="page-header">
            <h1>ì˜ì—…ì ì•ˆë‚´</h1>
            <p class="subtitle">ê°€ê¹Œìš´ ê³³ì—ì„œ ê³ ê°ë‹˜ì„ ê¸°ë‹¤ë¦¬ê² ìŠµë‹ˆë‹¤.</p>
        </div>

        <!-- íƒ­ ë©”ë‰´ -->
        <div class="tab-menu">
            <button class="tab-btn active" data-tab="branch">ì˜ì—…ì </button>
            <button class="tab-btn" data-tab="corner365">365ì½”ë„ˆ</button>
            <button class="tab-btn" data-tab="corner24">24/365ì½”ë„ˆ</button>
            <button class="tab-btn" data-tab="overseas">í•´ì™¸ì§€ì </button>
            <button class="tab-btn" data-tab="safebox">ëŒ€ì—¬ê¸ˆê³ </button>
            <button class="tab-btn" data-tab="lotteatm">ë¡¯ë°ATM</button>
            <button class="tab-btn" data-tab="stm">STM</button>
            <button class="tab-btn" data-tab="foreignatm">ì™¸êµ­ATM</button>
        </div>

        <!-- ê²€ìƒ‰ ì„¹ì…˜ -->
        <div class="search-section">
            <div class="search-container">
                <select id="districtSelect" class="search-select">
                    <option value="">ì„ íƒ</option>
                    <option value="jung">ì¤‘êµ¬</option>
                    <option value="seo">ì„œêµ¬</option>
                    <option value="dong">ë™êµ¬</option>
                    <option value="yeongdo">ì˜ë„êµ¬</option>
                    <option value="busanjin">ë¶€ì‚°ì§„êµ¬</option>
                    <option value="dongrae">ë™ë˜êµ¬</option>
                    <option value="nam">ë‚¨êµ¬</option>
                    <option value="buk">ë¶êµ¬</option>
                    <option value="gangseo">ê°•ì„œêµ¬</option>
                    <option value="geumjeong">ê¸ˆì •êµ¬</option>
                    <option value="sasang">ì‚¬ìƒêµ¬</option>
                    <option value="gijang">ê¸°ì¥êµ°</option>
                </select>
                <button id="searchBtn" class="search-btn">ê²€ìƒ‰</button>
            </div>
        </div>

        <!-- ë©”ì¸ ì½˜í…ì¸  -->
        <div class="content-wrapper">
            <!-- ì¢Œì¸¡: ì§€ì  ëª©ë¡ -->
            <div class="branch-list-section">
                <div id="branchList" class="branch-list"></div>
                <div class="pagination">
                    <button class="page-btn" id="prevBtn">ì´ì „</button>
                    <div id="pageNumbers" class="page-numbers"></div>
                    <button class="page-btn" id="nextBtn">ë‹¤ìŒ</button>
                </div>
            </div>

            <!-- ìš°ì¸¡: ì§€ë„ -->
            <div class="map-section">
                <div class="map-controls">
                    <button id="skySkyViewBtn" class="map-btn">ìœ„ì„±ë·°</button>
                </div>
                <div id="map" class="map-container"></div>
                <div class="map-info">
                    <div id="mapInfoContent" class="info-content">
                        <p>ì§€ì ì„ ì„ íƒí•˜ë©´ ì •ë³´ê°€ í‘œì‹œë©ë‹ˆë‹¤.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>

<!-- FOOTER -->
<footer>
    <section class="footer">
        <div class="container">
            <div class="f-link">
                <a href="#" class="link-active">ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨</a>
                <a href="#">ê³ ê°ì •ë³´ì·¨ê¸‰ë°©ì¹¨</a>
                <a href="#">ê²½ì˜ê³µì‹œ</a>
            </div>
            <div class="f-number">
                ê³ ê°ì„¼í„°<strong>1588-6200, 1544-6200</strong>
            </div>
            <div class="f-copy">COPYTRIGHT Â© 2014 BUSANBANK. ALL RIGHTS RESERVED.</div>
            <button id="topBtn" class="top-btn" aria-label="ë§¨ ìœ„ë¡œ ì´ë™">â†‘</button>
        </div>
    </section>
</footer>

<!-- ì¹´ì¹´ì˜¤ë§µ API (âœ… autoload=false ì„¤ì •) -->
<script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=fcb02db403a511ea44eb59837485cda6&libraries=services,clusterer,drawing&autoload=false"></script>

<!-- ì˜ì—…ì  ì•ˆë‚´ JavaScript -->
<script>
    console.log('ğŸ”§ ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ ì‹œì‘');

    class BranchInfoManager {
        constructor() {
            this.currentPage = 1;
            this.itemsPerPage = 10;
            this.allBranches = [];
            this.filteredBranches = [];
            this.map = null;
            this.markers = [];
            this.infoWindows = [];
            this.selectedBranchId = null;
            this.currentTab = 'branch';
            this.isMapMode = true;

            this.init();
        }

        init() {
            this.setupEventListeners();
            this.loadSampleData();
            this.initializeKakaoMap();
            this.setupTopButton();
        }

        setupEventListeners() {
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', (e) => this.handleTabChange(e));
            });

            document.getElementById('searchBtn').addEventListener('click', () => this.handleSearch());
            document.getElementById('districtSelect').addEventListener('change', () => this.handleSearch());

            document.getElementById('prevBtn').addEventListener('click', () => this.prevPage());
            document.getElementById('nextBtn').addEventListener('click', () => this.nextPage());

            document.addEventListener('click', (e) => {
                if (e.target.closest('.branch-item')) {
                    const item = e.target.closest('.branch-item');
                    this.selectBranch(item);
                }
            });

            document.getElementById('skySkyViewBtn').addEventListener('click', () => this.toggleView());
        }

        initializeKakaoMap() {
            console.log('ğŸ—ºï¸ ì§€ë„ ì´ˆê¸°í™” ì‹œì‘');

            if (typeof kakao === 'undefined' || !kakao.maps) {
                console.error('âŒ ì¹´ì¹´ì˜¤ë§µ APIë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                return;
            }

            // âœ… kakao.maps.load() ì½œë°± ì‚¬ìš© (autoload=falseì™€ í•¨ê»˜)
            kakao.maps.load(() => {
                console.log('âœ… ì¹´ì¹´ì˜¤ë§µ API ë¡œë“œ ì™„ë£Œ!');

                const mapContainer = document.getElementById('map');
                const mapOptions = {
                    center: new kakao.maps.LatLng(35.1796, 129.0756), // ë¶€ì‚° ì‹œì²­
                    level: 8
                };

                try {
                    this.map = new kakao.maps.Map(mapContainer, mapOptions);
                    console.log('âœ… ì§€ë„ ìƒì„± ì„±ê³µ');

                    kakao.maps.event.addListener(this.map, 'click', () => {
                        this.closeAllInfoWindows();
                    });

                    // í˜„ì¬ í˜ì´ì§€ ì§€ì ë“¤ì˜ ë§ˆì»¤ í‘œì‹œ
                    this.renderMapMarkers();

                } catch (error) {
                    console.error('âŒ ì§€ë„ ìƒì„± ì¤‘ ì˜¤ë¥˜:', error);
                }
            });
        }

        loadSampleData() {
            const dataByTab = {
                branch: [
                    { id: 1, name: 'ì¤‘ì•™ë™ê¸ˆìœµì„¼í„°ì§€ì ', branchCode: '015', address: 'ë¶€ì‚°ì‹œ ì¤‘êµ¬ ì¤‘ì•™ëŒ€ë¡œ 96', phone: '051-469-0181', fax: '051-608-5015', openDate: '1968-02-01', latitude: 35.0982, longitude: 129.0338, has365Corner: true, hasForeignExchange: true, hasSafebox: true, hasNightSafebox: false },
                    { id: 2, name: 'ë¶€ì‚°ì§„ì§€ì ', branchCode: '080', address: 'ë¶€ì‚°ì‹œ ë¶€ì‚°ì§„êµ¬ ì¤‘ì•™ë¡œ 100', phone: '051-803-0854', fax: '051-809-8547', openDate: '1990-06-15', latitude: 35.1648, longitude: 129.0590, has365Corner: true, hasForeignExchange: true, hasSafebox: true, hasNightSafebox: true },
                    { id: 3, name: 'ì„œë©´ì§€ì ', branchCode: '050', address: 'ë¶€ì‚°ì‹œ ë¶€ì‚°ì§„êµ¬ ì„œë©´ë¡œ 97', phone: '051-632-8501', fax: '051-632-8502', openDate: '1985-03-20', latitude: 35.1549, longitude: 129.0626, has365Corner: false, hasForeignExchange: false, hasSafebox: false, hasNightSafebox: false },
                    { id: 4, name: 'ì˜ë„ì§€ì ', branchCode: '025', address: 'ë¶€ì‚°ì‹œ ì˜ë„êµ¬ íƒœì¢…ë¡œ 111-33', phone: '051-242-3571', fax: '051-242-3572', openDate: '1975-09-10', latitude: 35.0732, longitude: 129.0689, has365Corner: false, hasForeignExchange: false, hasSafebox: false, hasNightSafebox: false },
                    { id: 5, name: 'í•´ìš´ëŒ€ì§€ì ', branchCode: '140', address: 'ë¶€ì‚°ì‹œ í•´ìš´ëŒ€êµ¬ í•´ìš´ëŒ€ë¡œ 100', phone: '051-743-2000', fax: '051-743-2100', openDate: '1995-11-05', latitude: 35.1606, longitude: 129.1618, has365Corner: true, hasForeignExchange: true, hasSafebox: true, hasNightSafebox: false },
                    { id: 6, name: 'ë™ë˜ì§€ì ', branchCode: '030', address: 'ë¶€ì‚°ì‹œ ë™ë˜êµ¬ ëª…ì¹˜ë¡œ 150', phone: '051-557-5000', fax: '051-557-5001', openDate: '1972-01-15', latitude: 35.1945, longitude: 129.0785, has365Corner: false, hasForeignExchange: false, hasSafebox: false, hasNightSafebox: false },
                    { id: 7, name: 'ë‚¨í¬ì§€ì ', branchCode: '035', address: 'ë¶€ì‚°ì‹œ ì¤‘êµ¬ ì¤‘ì•™ë¡œ 60', phone: '051-464-3000', fax: '051-464-3001', openDate: '1980-05-01', latitude: 35.0952, longitude: 129.0350, has365Corner: false, hasForeignExchange: false, hasSafebox: false, hasNightSafebox: false },
                    { id: 8, name: 'ê´‘ë³µì§€ì ', branchCode: '040', address: 'ë¶€ì‚°ì‹œ ë™êµ¬ ê´‘ë³µë¡œ 200', phone: '051-464-3500', fax: '051-464-3501', openDate: '1982-07-20', latitude: 35.1125, longitude: 129.0458, has365Corner: false, hasForeignExchange: false, hasSafebox: false, hasNightSafebox: false },
                    { id: 9, name: 'ì„¼í…€ì§€ì ', branchCode: '141', address: 'ë¶€ì‚°ì‹œ í•´ìš´ëŒ€êµ¬ ì„¼í…€ë¡œ 100', phone: '051-743-2500', fax: '051-743-2600', openDate: '2000-03-10', latitude: 35.1708, longitude: 129.1238, has365Corner: true, hasForeignExchange: true, hasSafebox: true, hasNightSafebox: true },
                    { id: 10, name: 'ë¶€ì‚°ëŒ€ì§€ì ', branchCode: '055', address: 'ë¶€ì‚°ì‹œ ê¸ˆì •êµ¬ ë¶€ì‚°ëŒ€ë¡œ 49', phone: '051-510-0110', fax: '051-510-0111', openDate: '1988-02-28', latitude: 35.2335, longitude: 129.0716, has365Corner: false, hasForeignExchange: false, hasSafebox: false, hasNightSafebox: false }
                ],
                corner365: [
                    { id: 101, name: 'ë¶€ì‚°ì—­ 365ì½”ë„ˆ', branchCode: '315', address: 'ë¶€ì‚°ì‹œ ë™êµ¬ ì¤‘ì•™ëŒ€ë¡œ 206', phone: '051-464-7777', fax: '-', openDate: '2010-05-15', latitude: 35.1126, longitude: 129.0410, has365Corner: true, hasForeignExchange: false, hasSafebox: false, hasNightSafebox: false },
                    { id: 102, name: 'ì„œë©´ 365ì½”ë„ˆ', branchCode: '350', address: 'ë¶€ì‚°ì‹œ ë¶€ì‚°ì§„êµ¬ ë™ì²œë¡œ 109', phone: '051-807-6666', fax: '-', openDate: '2012-03-20', latitude: 35.1539, longitude: 129.0635, has365Corner: true, hasForeignExchange: false, hasSafebox: false, hasNightSafebox: false },
                    { id: 103, name: 'í•´ìš´ëŒ€ 365ì½”ë„ˆ', branchCode: '342', address: 'ë¶€ì‚°ì‹œ í•´ìš´ëŒ€êµ¬ í•´ìš´ëŒ€ë¡œ 200', phone: '051-743-9999', fax: '-', openDate: '2008-11-10', latitude: 35.1606, longitude: 129.1710, has365Corner: true, hasForeignExchange: false, hasSafebox: false, hasNightSafebox: false },
                    { id: 104, name: 'ëª…ì§€ 365ì½”ë„ˆ', branchCode: '340', address: 'ë¶€ì‚°ì‹œ ìˆ˜ì˜êµ¬ ê´‘ì•ˆë¦¬ 1', phone: '051-755-5555', fax: '-', openDate: '2009-06-01', latitude: 35.1616, longitude: 129.1240, has365Corner: true, hasForeignExchange: false, hasSafebox: false, hasNightSafebox: false },
                    { id: 105, name: 'ë‚¨í¬ë™ 365ì½”ë„ˆ', branchCode: '320', address: 'ë¶€ì‚°ì‹œ ì¤‘êµ¬ ê´‘ë³µë¡œ 1', phone: '051-464-2222', fax: '-', openDate: '2011-09-15', latitude: 35.0952, longitude: 129.0350, has365Corner: true, hasForeignExchange: false, hasSafebox: false, hasNightSafebox: false }
                ],
                corner24: [
                    { id: 201, name: 'ì¤‘ì•™ 24/365ì½”ë„ˆ', branchCode: '415', address: 'ë¶€ì‚°ì‹œ ì¤‘êµ¬ ì¤‘ì•™ë¡œ 17', phone: '051-464-3391', fax: '051-464-3392', openDate: '2015-01-15', latitude: 35.0982, longitude: 129.0338, has365Corner: true, hasForeignExchange: false, hasSafebox: false, hasNightSafebox: true },
                    { id: 202, name: 'ë¶€ì‚°ì§„ 24/365ì½”ë„ˆ', branchCode: '480', address: 'ë¶€ì‚°ì‹œ ë¶€ì‚°ì§„êµ¬ ì¤‘ì•™ë¡œ 100', phone: '051-803-0854', fax: '051-803-0855', openDate: '2016-06-20', latitude: 35.1648, longitude: 129.0590, has365Corner: true, hasForeignExchange: false, hasSafebox: false, hasNightSafebox: true },
                    { id: 203, name: 'í•´ìš´ëŒ€ 24/365ì½”ë„ˆ', branchCode: '442', address: 'ë¶€ì‚°ì‹œ í•´ìš´ëŒ€êµ¬ í•´ìš´ëŒ€ë¡œ 100', phone: '051-743-2000', fax: '051-743-2001', openDate: '2017-03-10', latitude: 35.1606, longitude: 129.1618, has365Corner: true, hasForeignExchange: false, hasSafebox: false, hasNightSafebox: true }
                ],
                overseas: [],
                safebox: [
                    { id: 401, name: 'ì¤‘ì•™ì§€ì  ëŒ€ì—¬ê¸ˆê³ ', branchCode: '015-SB', address: 'ë¶€ì‚°ì‹œ ì¤‘êµ¬ ì¤‘ì•™ë¡œ 17 (3ì¸µ)', phone: '051-464-3391', fax: '051-464-3392', openDate: '1968-02-01', latitude: 35.0982, longitude: 129.0338, has365Corner: false, hasForeignExchange: false, hasSafebox: true, hasNightSafebox: false },
                    { id: 402, name: 'ë¶€ì‚°ì§„ì§€ì  ëŒ€ì—¬ê¸ˆê³ ', branchCode: '080-SB', address: 'ë¶€ì‚°ì‹œ ë¶€ì‚°ì§„êµ¬ ì¤‘ì•™ë¡œ 100 (2ì¸µ)', phone: '051-803-0854', fax: '051-809-8547', openDate: '1990-06-15', latitude: 35.1648, longitude: 129.0590, has365Corner: false, hasForeignExchange: false, hasSafebox: true, hasNightSafebox: false },
                    { id: 403, name: 'í•´ìš´ëŒ€ì§€ì  ëŒ€ì—¬ê¸ˆê³ ', branchCode: '140-SB', address: 'ë¶€ì‚°ì‹œ í•´ìš´ëŒ€êµ¬ í•´ìš´ëŒ€ë¡œ 100 (4ì¸µ)', phone: '051-743-2000', fax: '051-743-2100', openDate: '1995-11-05', latitude: 35.1606, longitude: 129.1618, has365Corner: false, hasForeignExchange: false, hasSafebox: true, hasNightSafebox: false },
                    { id: 404, name: 'ì„¼í…€ì§€ì  ëŒ€ì—¬ê¸ˆê³ ', branchCode: '141-SB', address: 'ë¶€ì‚°ì‹œ í•´ìš´ëŒ€êµ¬ ì„¼í…€ë¡œ 100 (3ì¸µ)', phone: '051-743-2500', fax: '051-743-2600', openDate: '2000-03-10', latitude: 35.1708, longitude: 129.1238, has365Corner: false, hasForeignExchange: false, hasSafebox: true, hasNightSafebox: false }
                ],
                lotteatm: [
                    { id: 501, name: 'ë¡¯ë°ë°±í™”ì  ë¶€ì‚°ì  ATM', branchCode: 'ATM-001', address: 'ë¶€ì‚°ì‹œ ì¤‘êµ¬ ë§¤ì¶•ë¡œ 1', phone: '051-1588-2500', fax: '-', openDate: '2000-01-01', latitude: 35.1044, longitude: 129.0367, has365Corner: false, hasForeignExchange: false, hasSafebox: false, hasNightSafebox: false },
                    { id: 502, name: 'ë¡¯ë°ë§ˆíŠ¸ ë¶€ì‚°ì§„ì  ATM', branchCode: 'ATM-002', address: 'ë¶€ì‚°ì‹œ ë¶€ì‚°ì§„êµ¬ ì¤‘ì•™ë¡œ 59', phone: '051-1588-2500', fax: '-', openDate: '2002-05-20', latitude: 35.1549, longitude: 129.0626, has365Corner: false, hasForeignExchange: false, hasSafebox: false, hasNightSafebox: false },
                    { id: 503, name: 'ë¡¯ë°ì›”ë“œëª° ë¶€ì‚°ì  ATM', branchCode: 'ATM-003', address: 'ë¶€ì‚°ì‹œ í•´ìš´ëŒ€êµ¬ ì„¼í…€ë¡œ 54', phone: '051-1588-2500', fax: '-', openDate: '2005-08-15', latitude: 35.1708, longitude: 129.1238, has365Corner: false, hasForeignExchange: false, hasSafebox: false, hasNightSafebox: false }
                ],
                stm: [
                    { id: 601, name: 'ì¤‘ì•™ì—­ STM', branchCode: 'STM-001', address: 'ë¶€ì‚°ì‹œ ë™êµ¬ ì¤‘ì•™ëŒ€ë¡œ ì§€í•˜ì² ì—­', phone: '1588-6200', fax: '-', openDate: '2008-06-01', latitude: 35.1126, longitude: 129.0410, has365Corner: false, hasForeignExchange: false, hasSafebox: false, hasNightSafebox: false },
                    { id: 602, name: 'ë¶€ì‚°ì§„ì—­ STM', branchCode: 'STM-002', address: 'ë¶€ì‚°ì‹œ ë¶€ì‚°ì§„êµ¬ ì¤‘ì•™ë¡œ ì§€í•˜ì² ì—­', phone: '1588-6200', fax: '-', openDate: '2010-09-15', latitude: 35.1648, longitude: 129.0590, has365Corner: false, hasForeignExchange: false, hasSafebox: false, hasNightSafebox: false },
                    { id: 603, name: 'í•´ìš´ëŒ€ì—­ STM', branchCode: 'STM-003', address: 'ë¶€ì‚°ì‹œ í•´ìš´ëŒ€êµ¬ ì„¼í…€ë¡œ ì§€í•˜ì² ì—­', phone: '1588-6200', fax: '-', openDate: '2012-02-20', latitude: 35.1606, longitude: 129.1618, has365Corner: false, hasForeignExchange: false, hasSafebox: false, hasNightSafebox: false }
                ],
                foreignatm: [
                    { id: 701, name: 'ë¶€ì‚°ê³µí•­ ì™¸êµ­í™˜ATM', branchCode: 'FATM-001', address: 'ë¶€ì‚°ì‹œ ê°•ì„œêµ¬ ê³µí•­ë¡œ 60 ê¹€í•´ê³µí•­', phone: '051-974-3600', fax: '-', openDate: '2006-03-01', latitude: 35.1794, longitude: 128.9383, has365Corner: true, hasForeignExchange: true, hasSafebox: false, hasNightSafebox: false },
                    { id: 702, name: 'ë¶€ì‚°í•­ ì™¸êµ­í™˜ATM', branchCode: 'FATM-002', address: 'ë¶€ì‚°ì‹œ ì¤‘êµ¬ ì‹ í•­ë¡œ 140 ë¶€ì‚°í•­', phone: '051-600-7700', fax: '-', openDate: '2009-05-15', latitude: 35.1056, longitude: 129.0710, has365Corner: false, hasForeignExchange: true, hasSafebox: false, hasNightSafebox: false },
                    { id: 703, name: 'í•´ìš´ëŒ€ ì™¸êµ­í™˜ATM', branchCode: 'FATM-003', address: 'ë¶€ì‚°ì‹œ í•´ìš´ëŒ€êµ¬ ì¤‘ì•™ë¡œ 100 í˜¸í…” 1ì¸µ', phone: '051-743-2000', fax: '-', openDate: '2011-07-20', latitude: 35.1606, longitude: 129.1618, has365Corner: true, hasForeignExchange: true, hasSafebox: false, hasNightSafebox: false }
                ]
            };

            this.allBranches = dataByTab[this.currentTab] || [];
            this.filteredBranches = [...this.allBranches];
            this.renderBranchList();
            this.renderPagination();
        }

        handleTabChange(e) {
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            e.target.classList.add('active');
            this.currentTab = e.target.dataset.tab;
            this.currentPage = 1;
            this.selectedBranchId = null;
            document.getElementById('mapInfoContent').innerHTML = '<p>ì§€ì ì„ ì„ íƒí•˜ë©´ ì •ë³´ê°€ í‘œì‹œë©ë‹ˆë‹¤.</p>';
            this.loadSampleData();
        }

        handleSearch() {
            const district = document.getElementById('districtSelect').value;

            if (district === '') {
                this.filteredBranches = [...this.allBranches];
            } else {
                this.filteredBranches = this.allBranches.filter(branch =>
                    this.getDistrictFromAddress(branch.address) === district
                );
            }

            this.currentPage = 1;
            this.renderBranchList();
            this.renderPagination();
        }

        getDistrictFromAddress(address) {
            const districts = {
                'ì¤‘êµ¬': 'jung', 'ì„œêµ¬': 'seo', 'ë™êµ¬': 'dong', 'ì˜ë„êµ¬': 'yeongdo',
                'ë¶€ì‚°ì§„êµ¬': 'busanjin', 'ë™ë˜êµ¬': 'dongrae', 'ë‚¨êµ¬': 'nam', 'ë¶êµ¬': 'buk',
                'ê°•ì„œêµ¬': 'gangseo', 'ê¸ˆì •êµ¬': 'geumjeong', 'ì‚¬ìƒêµ¬': 'sasang', 'ê¸°ì¥êµ°': 'gijang'
            };

            for (let [key, value] of Object.entries(districts)) {
                if (address.includes(key)) {
                    return value;
                }
            }
            return '';
        }

        renderBranchList() {
            const branchList = document.getElementById('branchList');
            const start = (this.currentPage - 1) * this.itemsPerPage;
            const end = start + this.itemsPerPage;
            const pageBranches = this.filteredBranches.slice(start, end);

            if (pageBranches.length === 0) {
                branchList.innerHTML = '<div class="error">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
                return;
            }

            branchList.innerHTML = pageBranches.map((branch, index) => `
                    <div class="branch-item" data-id="${branch.id}">
                        <div class="branch-header">
                            <h3 class="branch-name">${start + index + 1}. ${branch.name}</h3>
                            ${branch.hasSafebox ? '<span class="tag-safebox">ëŒ€ì—¬ê¸ˆê³ </span>' : ''}
                        </div>
                        <div class="branch-info">
                            <div class="branch-detail">
                                <span class="label">ì§€ì ì½”ë“œ</span>
                                <span class="value">${branch.branchCode}</span>
                            </div>
                            <div class="branch-detail">
                                <span class="label">ê°œì ì¼</span>
                                <span class="value">${branch.openDate}</span>
                            </div>
                            <div class="branch-detail">
                                <span class="label">ëŒ€ê¸°ê³ ê°</span>
                                <span class="value">${Math.floor(Math.random() * 20) + 1}ëª…</span>
                            </div>
                        </div>
                        <div class="branch-detail full-width">
                            <span class="label">ì£¼ì†Œ</span>
                            <span class="value">${branch.address}</span>
                        </div>
                        <div class="branch-info">
                            <div class="branch-detail">
                                <span class="label">365ì½”ë„ˆ</span>
                                <span class="value">${branch.has365Corner ? 'â—¯' : 'âœ•'}</span>
                            </div>
                            <div class="branch-detail">
                                <span class="label">ì™¸êµ­í™˜</span>
                                <span class="value">${branch.hasForeignExchange ? 'â—¯' : 'âœ•'}</span>
                            </div>
                            <div class="branch-detail">
                                <span class="label">ì•¼ê°„ê¸ˆê³ </span>
                                <span class="value">${branch.hasNightSafebox ? 'â—¯' : 'âœ•'}</span>
                            </div>
                        </div>
                        <div class="branch-footer">
                            <span class="phone">${branch.phone}</span>
                        </div>
                    </div>
                `).join('');

            // ì§€ë„ì— í˜„ì¬ í˜ì´ì§€ì˜ ë§ˆì»¤ í‘œì‹œ
            this.renderMapMarkers();
        }

        renderMapMarkers() {
            if (!this.map) {
                console.log('âš ï¸ ì§€ë„ê°€ ì•„ì§ ì¤€ë¹„ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤');
                return;
            }

            // ê¸°ì¡´ ë§ˆì»¤ ì œê±°
            this.markers.forEach(marker => marker.setMap(null));
            this.markers = [];

            const start = (this.currentPage - 1) * this.itemsPerPage;
            const end = start + this.itemsPerPage;
            const pageBranches = this.filteredBranches.slice(start, end);

            if (pageBranches.length === 0) {
                return;
            }

            const bounds = new kakao.maps.LatLngBounds();

            pageBranches.forEach(branch => {
                const position = new kakao.maps.LatLng(branch.latitude, branch.longitude);
                bounds.extend(position);

                const marker = new kakao.maps.Marker({
                    map: this.map,
                    position: position,
                    title: branch.name
                });

                this.markers.push(marker);
            });

            if (pageBranches.length > 0) {
                this.map.setBounds(bounds);
            }
        }

        renderPagination() {
            const totalPages = Math.ceil(this.filteredBranches.length / this.itemsPerPage);
            const pageNumbers = document.getElementById('pageNumbers');

            pageNumbers.innerHTML = '';

            let startPage = Math.max(1, this.currentPage - 2);
            let endPage = Math.min(totalPages, startPage + 4);

            if (endPage - startPage < 4) {
                startPage = Math.max(1, endPage - 4);
            }

            for (let i = startPage; i <= endPage; i++) {
                const pageBtn = document.createElement('button');
                pageBtn.className = `page-num ${i === this.currentPage ? 'active' : ''}`;
                pageBtn.textContent = i;
                pageBtn.addEventListener('click', () => this.goToPage(i));
                pageNumbers.appendChild(pageBtn);
            }

            document.getElementById('prevBtn').disabled = this.currentPage === 1;
            document.getElementById('nextBtn').disabled = this.currentPage === totalPages;
        }

        prevPage() {
            if (this.currentPage > 1) {
                this.currentPage--;
                this.renderBranchList();
                this.renderPagination();
            }
        }

        nextPage() {
            const totalPages = Math.ceil(this.filteredBranches.length / this.itemsPerPage);
            if (this.currentPage < totalPages) {
                this.currentPage++;
                this.renderBranchList();
                this.renderPagination();
            }
        }

        goToPage(pageNum) {
            this.currentPage = pageNum;
            this.renderBranchList();
            this.renderPagination();
        }

        selectBranch(element) {
            document.querySelectorAll('.branch-item').forEach(item => {
                item.classList.remove('active');
            });

            element.classList.add('active');

            const branchId = element.dataset.id;
            const branch = this.allBranches.find(b => b.id == branchId);

            if (branch) {
                this.selectedBranchId = branchId;
                this.showBranchInfo(branch);

                // ì§€ë„ ì¤‘ì‹¬ì„ ì„ íƒí•œ ì§€ì ìœ¼ë¡œ ì´ë™
                if (this.map) {
                    const position = new kakao.maps.LatLng(branch.latitude, branch.longitude);
                    this.map.panTo(position);
                }
            }
        }

        showBranchInfo(branch) {
            const mapInfoContent = document.getElementById('mapInfoContent');
            mapInfoContent.innerHTML = `
                    <div class="info-content">
                        <div class="info-title">${branch.name}</div>
                        <div class="info-item">
                            <span class="info-label">ì§€ì ì½”ë“œ</span>
                            <span class="info-value">${branch.branchCode}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">ì „í™”</span>
                            <span class="info-value highlight">${branch.phone}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">íŒ©ìŠ¤</span>
                            <span class="info-value">${branch.fax || '-'}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">ì£¼ì†Œ</span>
                            <span class="info-value">${branch.address}</span>
                        </div>
                    </div>
                `;
        }

        toggleView() {
            const btn = document.getElementById('skySkyViewBtn');
            if (!this.map) return;

            if (this.isMapMode) {
                this.map.setMapTypeId(kakao.maps.MapTypeId.HYBRID);
                btn.textContent = 'ì§€ë„ë³´ê¸°';
                this.isMapMode = false;
            } else {
                this.map.setMapTypeId(kakao.maps.MapTypeId.ROADMAP);
                btn.textContent = 'ìœ„ì„±ë·°';
                this.isMapMode = true;
            }
        }

        closeAllInfoWindows() {
            this.infoWindows.forEach(infoWindow => {
                infoWindow.close();
            });
            this.infoWindows = [];
        }

        setupTopButton() {
            const topBtn = document.getElementById('topBtn');
            window.addEventListener('scroll', () => {
                if (window.scrollY > 300) {
                    topBtn.classList.add('show');
                } else {
                    topBtn.classList.remove('show');
                }
            });

            topBtn.addEventListener('click', () => {
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });
        }
    }

    document.addEventListener('DOMContentLoaded', () => {
        console.log('ğŸ“„ DOM ë¡œë“œ ì™„ë£Œ, BranchInfoManager ì´ˆê¸°í™”');
        window.branchManager = new BranchInfoManager();
    });
</script>
</body>
</html>